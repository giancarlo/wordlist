<script src="index.bundle.min.js"></script>
<title>Words</title>
<style>
	.selected {
		opacity: 0.6;
	}
	.selected cxl-button {
		padding-left: 0px;
		padding-right: 0px;
	}
	cxl-button {
		justify-content: center;
		transition: padding 0.2s;
	}
	#output {
		height: 56px;
		font-size: 38px;
		flex-shrink: 0;
		background: #eee;
		align-items: center;
		overflow-x: auto;
		overflow-y: hidden;
		white-space: nowrap;
	}
</style>
<cxl-meta></cxl-meta>
<cxl-flex vflex fill style="overflow: hidden">
	<cxl-flex pad="8" gap="8">
		<cxl-button
			onclick="output.innerText += ' YES'"
			size="3"
			color="success"
			>YES</cxl-button
		>
		<cxl-button
			id="btnReset"
			style="margin-left: auto; margin-right: auto"
			size="3"
			>RESET</cxl-button
		>
		<cxl-button onclick="output.innerText += ' NO'" size="3" color="error"
			>NO</cxl-button
		>
	</cxl-flex>
	<cxl-flex id="output" pad="8"></cxl-flex>
	<cxl-flex
		style="overflow-y: hidden; overflow-x: auto"
		id="columns"
		grow
		gap="16"
		pad="8"
		vpad="4"
	>
		<cxl-flex vflex gap="8"></cxl-flex>
		<cxl-flex vflex gap="8"></cxl-flex>
		<cxl-flex vflex gap="8"></cxl-flex>
		<cxl-flex vflex gap="8"></cxl-flex>
		<cxl-flex vflex gap="8"></cxl-flex>
		<cxl-flex
			style="flex-wrap: wrap"
			vflex
			gap="16"
			id="firstWords"
		></cxl-flex>
	</cxl-flex>
</cxl-flex>

<script type="module">
	const { dom } = require("@cxl/tsx");
	const { empty } = require("@cxl/dom");
	const columns = document.getElementById("columns").children;
	const firstWords = document.getElementById("firstWords");
	const maxMatch = 22;

	btnReset.onclick = () => {
		for (let i = 1; i < columns.length; i++) {
			columns[i].className = "";
			empty(columns[i]);
		}
		output.innerText = "";
		columns[0].className = "";
		const selected = columns[0].querySelector('[color="primary"]');
		if (selected) selected.color = undefined;
	};

	function updateWords(words, regstr, level) {
		empty(firstWords);
		const regex = new RegExp(`^${regstr}.+`, "gim");
		const level2 = {};
		let m,
			count = maxMatch;
		let selected2;
		while ((m = regex.exec(words))) {
			if (count-- > 0) {
				const btn = dom("cxl-button", { size: 5 });
				btn.innerText = m[0];
				btn.onclick = () => {
					output.innerText += ` ${btn.innerText}`;
				};
				firstWords.appendChild(btn);
			}
			const key = m[0].slice(0, level + 2);
			level2[key] = (level2[key] ?? 0) + 1;
		}
		for (let i = level + 1; i < columns.length - 1; i++) {
			columns[i].className = "";
			empty(columns[i]);
		}

		if (count <= 0 && level <= 5)
			Object.entries(level2)
				.sort((a, b) => (a[1] > b[1] ? -1 : 1))
				.forEach(([key]) => {
					const btn = dom("cxl-button", { size: 4 });
					btn.innerText = key;
					btn.onclick = () => {
						if (selected2) selected2.color = undefined;
						btn.color = "primary";
						selected2 = btn;
						columns[level + 1].className = "selected";
						updateWords(words, key, level + 1);
					};
					columns[level + 1].appendChild(btn);
				});
	}

	async function load() {
		const data = await fetch("es-common.txt").then((r) => r.text());
		const count = 1;
		let start = "A";
		let selected1;

		do {
			const btn = dom("cxl-button", { size: 4 });
			let end = String.fromCharCode(start.charCodeAt(0) + count);
			if (end > "Z") end = "Z";
			const regstr = `[${start}-${end}]`;
			let label = start;
			for (let i = 1; i <= count; i++)
				label += `-${String.fromCharCode(start.charCodeAt(0) + i)}`;

			btn.onclick = () => {
				if (selected1) selected1.color = undefined;
				btn.color = "primary";
				selected1 = btn;
				columns[0].className = "selected";
				updateWords(data, regstr, 0);
			};
			btn.innerText = label; ///`${start}-${end}`;
			start = String.fromCharCode(start.charCodeAt(0) + count + 1);
			columns[0].appendChild(btn);
		} while (start < "Z");
	}

	load();
</script>
